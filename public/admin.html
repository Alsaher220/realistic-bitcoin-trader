// =========================
// ðŸ”¹ Admin Endpoints
// =========================

// Get all users
app.get("/admin/users", async (req, res) => {
  try {
    const result = await pool.query(
      "SELECT id, username, role, cash, btc FROM users ORDER BY id ASC"
    );
    res.json({ success: true, users: result.rows });
  } catch (err) {
    console.error("Error fetching users:", err);
    res.json({ success: false, message: "Error fetching users" });
  }
});

// Top up a userâ€™s balance
app.post("/admin/topup", async (req, res) => {
  const { userId, cash, btc } = req.body;
  try {
    await pool.query(
      "UPDATE users SET cash = cash + $1, btc = btc + $2 WHERE id = $3",
      [cash, btc, userId]
    );
    res.json({ success: true });
  } catch (err) {
    console.error("Error topping up:", err);
    res.json({ success: false, message: "Error topping up" });
  }
});

// Get trade history
app.get("/admin/trades", async (req, res) => {
  try {
    const result = await pool.query(
      `SELECT t.id, t.type, t.amount, t.price, t.date, u.username
       FROM trades t
       JOIN users u ON t.user_id = u.id
       ORDER BY t.date DESC`
    );
    res.json({ success: true, trades: result.rows });
  } catch (err) {
    console.error("Error fetching trades:", err);
    res.json({ success: false, message: "Error fetching trades" });
  }
});
